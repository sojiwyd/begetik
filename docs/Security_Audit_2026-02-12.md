# Аудит безопасности (12.02.2026)

## Проверенные направления
- SQL Injection
- XSS
- CSRF
- IDOR
- Контроль доступа по ролям

## Результаты проверки

### SQL Injection
- В критичных сценариях используются `prepare/execute` (авторизация, регистрация, CRUD, профиль, заказы).
- Прямая подстановка пользовательских данных в SQL не обнаружена в рабочих сценариях.

### XSS
- Для вывода данных используется функция `h()`/`htmlspecialchars`.
- Явных мест вывода сырых `$_GET/$_POST` без экранирования не обнаружено.

### CSRF
- Для форм изменения данных используется токен в сессии.
- Проверка `hash_equals` присутствует в изменяющих endpoint'ах (удаление, редактирование, смена пароля, создание записей).

### IDOR
- В `profile.php` и `order_details.php` выборка выполняется только для текущего `user_id`.
- Прямой просмотр чужих заказов заблокирован.

### Role-based Access
- Админские страницы защищены через `check_admin.php`.
- Роль сохраняется в сессии при успешном входе.

## Что улучшено в рамках интенсивов
- Добавлен API `api/get_slots.php` для календаря занятости.
- Добавлена загрузка изображения в `add_item.php` вместо ссылки.
- Включены поиск, пагинация и безопасные удаления.

## Остаточные риски и рекомендации
- Удалить или ограничить доступ к служебным скриптам `create_admin.php` и `hash_gen.php` на продакшене.
- Вынести боевой конфиг БД за пределы web-root.
- Подключить SonarCloud и устранить замечания уровня High.
